<% %>

<div id="category_assignments">
<% for category_assignment in @category_assignments %>
  <%
  flag = ''
  delete_action = link_to 'Destroy',
    polymorphic_path( [ @category_assignable, category_assignment ] ),
      :confirm => 'Are you sure?',
      :method => :delete
  make_primary = ''
  if category_assignment.primary_category.blank?
   make_primary = link_to 'make primary category',
     polymorphic_path( [ @category_assignable, category_assignment ],
       :category_assignment => { :primary_category => "1" } ),
     { :method => :put }
  else
    flag = '*'
  end
  %>
  <div class="category_assignment">
    <%= flag %>
    <%= category_assignment.category.name %>
    <%= make_primary %>
    <%= delete_action %>
  </div>
<% end %>
</div>

<% unless @lists[:categories].empty? %>
  <h2>New Category Assignment</h2>
   
  <% form_for [@category_assignable, CategoryAssignment.new] do |f| %>
    <%= f.error_messages %>
    <p>
      <%= f.label :category_id %>
      <%= f.select :category_id, @lists[:categories] %>
    </p>
    <p>
      <%= f.check_box :primary_category %>
      <%= f.label :primary_category %>
    </p>
    <p><%= f.submit "Submit" %></p>
  <% end %>
<% end %>
