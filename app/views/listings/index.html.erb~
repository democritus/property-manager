<div id="listings-index-content">

<% @listings.each do |listing| %>
  <%
  # Get categories associated with property or listing (listing categories 
  # overrides property)
  primary_category = ''
  if listing.categories.blank?
    unless listing.property.categories.blank?
      primary_category = listing.property.categories[0].name
    end
  else
    primary_category = listing.categories[0].name
  end
  %>
  <div class="listing-container clearfix">
    <div class="content clearfix">
      <%= thumbnail(listing.property.property_images[0],
        listing_path(listing, :anchor => 'information_request')) %>
      <div class="flowed-content">
        <%= price_div(listing.ask_amount, listing.ask_currency.symbol,
          listing.ask_currency.code) %>
        <h2><%= link_to listing.property.name, listing %></h2>
        <div class="section highlighted-items">
          <div>
            <%= primary_category %>
            <%
            bed_and_bath_text = bed_and_bath_formatted(
              listing.property.bedroom_number,
              listing.property.bathroom_number
            )
            unless bed_and_bath_text.blank?
              %> - <%=h bed_and_bath_text %>
            <% end %>
          </div>
          <%= location_formatted(listing.property.barrio.name,
            listing.property.barrio.market.name) %>
        </div>
        <ul class="info-list horizontal clearfix">
          <% unless listing.property.construction_size.blank? %>
            <%= content_tag(:li,
              construction_formatted(listing.property.construction_size)) %>
          <% end %>
          <% unless listing.property.land_size.blank? %>
            <%= content_tag(:li,
              land_formatted(listing.property.land_size)) %>
          <% end %>
          <% unless listing.property.stories.blank? %>
            <%= content_tag(:li,
              stories_formatted(listing.property.stories)) %>
          <% end %>
          <% unless listing.property.garage_spaces.blank? %>
            <%= content_tag(:li,
              garage_formatted(listing.property.garage_spaces)) %>
          <% end %>
          <% unless listing.property.parking_spaces.blank? %>
            <%= content_tag(:li,
              parking_formatted(listing.property.parking_spaces)) %>
          <% end %>
          <% unless listing.property.year_built.blank? %>
            <%= content_tag(:li,
              year_built_formatted(listing.property.year_built)) %>
          <% end %>
          <%= extra_features_inline(listing.features) %>
        </ul>
        
        <%= render(:partial => 'liaison', :locals => listing) %>

        <% unless listing.property.description.blank? %>
        <div class="section description">
          <div id="description-layer0">
            <strong><%= t(:description).capitalize %>:</strong> <%=h listing.property.description %>
          </div>
          <div class="show-more-box">
            <span id="description-trigger0" class="show-more">
              <%= image_tag 'right_arrow_black.png' %> <span><%= t(:show_full_description) %></span>
            </span>
          </div>
        </div>
        <% end %>

      </div>
    </div>
    <div class="footer">
      <div class="clearfix">
        <div class="reference-id">
          REF: <%= (listing.id).to_s %>
        </div>
        <div class="links">
          <ul class="horizontal float-right clearfix">
            <li><%= link_to t(:full_listing).capitalize, listing %></li>
            <li><%= link_to t(:request_info).capitalize,
              listing_path(listing, :anchor => 'information_request') %></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
<% end %>

</div>

<br />

<%= link_to t(:new_listing).capitalize, new_listing_path %>
