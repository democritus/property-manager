class CategoryAssignment < ActiveRecord::Base
  belongs_to :category
  belongs_to :category_assignable, :polymorphic => true
  
  after_save :enforce_one_primary_category
  
  def enforce_one_primary_category
    unless self.primary_category.nil?
      if self.primary_category
        CategoryAssignment.update_all(
          { :primary_category => false },
          #[ "`id` <> :id", { :id => self.id } ] # symbol syntax
          #[ '`id` <> ?', self.id ]
          '`id` <> "' + self.id + '"'
        )
      end
    end
  end
end
